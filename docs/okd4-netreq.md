# Требования к сети

Этот документ описывает требования к сети для установки и работы с кластером Openshift 4.X.

## Сеть в рамках кластера
Этот раздел описывает требования по доступу между узлами кластера. Узлы кластера Openshift делятся на 2 группы: мастера (masters, control plane) и рабочие узлы (workers). К последним относятся специализированные узлы, выполняющие такие роли как infra, storage, ingress итд.

Эти доступы находятся в ведении IT администраторов и не влияют на работу пользователей с кластером.

### Все узлы ко всем узлам

|Proto   |Port |Notes |
|--------|-----|------|
|ICMP    |-    |Тесты доступности сети |
|TCP     |1936 |Метрики |
|	     |10250-10259 |Порты k8s |
|	     |10256 |Openshift SDN |
|UDP     |4789 |VXLAN |
|        |6081 |VXLAN |
|TCP/UDP |30000 - 32767 |Порты узлов k8s |
|        |9000 - 9999 |Сервисы на уровне хостов |

### Все узлы к мастерам

|Proto |Port |Notes |
|------|-----|------|
|TCP   |6443 |API   |
|TCP   |22623 |Ignition config for new nodes |

### Мастера к мастерам

|Proto |Port        |Notes |
|------|------------|------|
|TCP   |2379 - 2380 |etcd  |

## Доступы к кластеру
Этот раздел описывает требования по доступу клиентов к кластеру. Клиенты включают в себя пользователей, разработчиков и администраторов, пользующихся как веб консолью, так и инструментами коммандной строки.

|Dest                                |Proto |Port |Role |Notes        |
|------------------------------------|------|-----|-----|-------------|
|балансировщик, обслуживающй *.apps.<cluster-name>.<base-domain> |TCP   |80   |все  |App ingress  |
|балансировщик, обслуживающй *.apps.<cluster-name>.<base-domain> |TCP   |443  |все  |App ingress  |
|балансировщик, обслуживающй api.<cluster-name>.<base-domain>    |TCP   |6443 |все   |API/CLI     |
|все узлы кластера                   |TCP   |22   |IT админы |SSH доступ |
|балансировщик, обслуживающй api.<cluster-name>.<base-domain>    |TCP   |22623 |Ignition для новых узлов |

Кластер Openshift и утилита OC поддерживают функцию [port-forwarding](https://docs.openshift.com/container-platform/4.8/nodes/containers/nodes-containers-port-forwarding.html), позволяющую в сценариях разработки и отладки приложений устанавливать прямой доступ между локальным портом и подами, слушающим на портах в кластере.
Это означает, что для обеспечения данного функционала со станций/VDI разработчиков требуется открыть проходы ко всем верхним портам на рабочих узлах на средах разработки и тестирования. 

## Доступы с кластера
Этот раздел описывает требования по доступу с узлов кластера к зависимостям, размещенным к сетям банка. 

Полностью список зависимостей поддерживается в проектах сетевой архитектуры АС DevOps, здесь перечислены главные зависимости:
|Dest                                |Proto |Port |Role |Notes        |
|------------------------------------|------|-----|-----|-------------|
|NTP серверы |UDP |123 |все  |Сетевое время  |
|DNS серверы |UDP |53 |все   |Сервис сетевых имен |
|DNS серверы |TCP |53 |все   |Сервис сетевых имен |
|LDAP/AD серверы |UDP   |389 |все  |Аутентификация |
|LDAP/AD серверы |TCP   |389 |все  |Аутентификация |
|LDAP/AD серверы |TCP   |636 |все  |Аутентификация |
|Каталоги Docker |TCP   |443 |Каталоги образов контейнеров |
|Каталоги Docker |TCP   |4000 |Каталоги образов контейнеров |
|Каталоги Docker |TCP   |5000 |Каталоги образов контейнеров |

Дополнительно может потребоваться доступ к сервисам хранения данных, таким как NFS определения которых зависит от систем, предоставляющих тома сетевого хранения данных и поддерживаемые протоколы.

## Доступ с proxy
Этот раздел описывает требования по доступу с интернет прокси сервера к URLам Red Hat для скачивания образов контейнеров, используемых в работе Openshift и при разработке приложений:
|URL	|Port	|Notes |
|-------|-------|------|
|registry.redhat.io |443, 80 |Provides core container images |
|quay.io |443, 80 |Provides core container images |
|*.quay.io |443, 80 |Provides core container images |
|openshift.org |443, 80 |Provides Red Hat Enterprise Linux CoreOS (RHCOS) images |
|mirror.openshift.com |443, 80 | Required to access mirrored installation content and images |
